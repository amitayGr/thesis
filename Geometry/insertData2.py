import pandas as pd
import sqlite3
from sqlalchemy import create_engine, MetaData, Table, insert, select

# חיבור למסד הנתונים
db_path = "geometry_learning.db"
DATABASE_URL = f"sqlite:///{db_path}"

# יצירת מנוע SQLAlchemy
engine = create_engine(DATABASE_URL, connect_args={"timeout": 30, "check_same_thread": False})
metadata = MetaData()
metadata.reflect(bind=engine)

# בדיקת קיום טבלאות
def check_tables():
    with sqlite3.connect(db_path) as conn:
        cursor = conn.cursor()
        cursor.execute("SELECT name FROM sqlite_master WHERE type='table';")
        tables = cursor.fetchall()
        if tables:
            print("✅ חיבור למסד הנתונים תקין! רשימת טבלאות:")
            for table in tables:
                print(f"📌 {table[0]}")
        else:
            print("⚠️ חיבור תקין, אך לא נמצאו טבלאות!")

# הכנסת נתונים לטבלת המשולשים
def insert_triangles():
    Triangles = metadata.tables["Triangles"]
    with engine.begin() as conn:  # ✅ שימוש בטרנזקציה
        existing_triangles = conn.execute(select(Triangles)).fetchall()
        if not existing_triangles:
            conn.execute(insert(Triangles), [
                {"triangle_id": 0, "triangle_type": "משולש כללי"},
                {"triangle_id": 1, "triangle_type": "משולש שווה צלעות"},
                {"triangle_id": 2, "triangle_type": "משולש שווה שוקיים"},
                {"triangle_id": 3, "triangle_type": "משולש ישר זווית"}
            ])
            print("✅ הנתונים לטבלת Triangles הוזנו בהצלחה!")
        else:
            print("⚠️ הנתונים בטבלת Triangles כבר קיימים.")

# הכנסת נתונים לטבלת המשפטים
def insert_theorems():
    Theorems = metadata.tables["Theorems"]
    with engine.begin() as conn:
        existing_theorems = conn.execute(select(Theorems)).fetchall()
        if not existing_theorems:
            conn.execute(insert(Theorems), [
                {"theorem_text": "סכום הזוויות של משולש הוא 180°", "category": 0},
                {"theorem_text": "סכום הזוויות החיצוניות שווה ל- 360°", "category": 0},
                {"theorem_text": "זווית חיצונית למשולש שווה לסכום שתי הזוויות הפנימיות שאינן צמודות לה", "category": 0},
                {
                    "theorem_text": "לכל זווית חיצונית במשולש יש זווית פנימית מולה, ושתי זוויות פנימיות שאינן סמוכות לה הן זוויות משלימות",
                    "category": 0},
                {"theorem_text": "במשולש (שאינו שווה זוויות), מול הזווית הגדולה ביותר מונחת הצלע הגדולה ביותר",
                 "category": 0},
                {"theorem_text": "סכום של כל שתי צלעות גדול מהצלע השלישית", "category": 0},
                {"theorem_text": "במשולש (שאינו שווה צלעות), מול הצלע הגדולה ביותר מונחת הזווית הגדולה ביותר",
                 "category": 0},
                {"theorem_text": "אם שני משולשים דומים, היחס בין הצלעות המתאימות יהיה קבוע", "category": 0},
                {"theorem_text": "במשולש, מול זוויות שוות מונחות צלעות שוות", "category": 0},
                {"theorem_text": "משפט תאלס: שני ישרים מקבילים החותכים שוקי זווית, מקצים עליהם קטעים פרופורציוניים",
                 "category": 0},
                {
                    "theorem_text": "משפט תאלס המורחב: ישר המקביל לאחת מצלעות המשולש חותך את שתי הצלעות האחרות או את המשכיהן בקטעים פרופורציוניים",
                    "category": 0},
                {
                    "theorem_text": "משפט הפוך למשפט תאלס: שני ישרים המקצים על שוקי זווית ארבעה קטעים פרופורציוניים הם ישרים מקבילים",
                    "category": 0},
                {"theorem_text": "לכל משולש יש 3 תיכונים", "category": 0},
                {"theorem_text": "שלושת התיכונים במשולש נחתכים בנקודה אחת", "category": 0},
                {"theorem_text": "נקודת חיתוך התיכונים מחלקת כל תיכון ביחס 2:1 (החלק הקרוב לקודקוד פי 2 מהחלק האחר)",
                 "category": 0},
                {"theorem_text": "שלושת הגבהים במשולש נחתכים בנקודה אחת", "category": 0},
                {"theorem_text": "שלושת חוצי הזוויות של משולש נחתכים בנקודה אחת, שהיא מרכז המעגל החסום במשולש",
                 "category": 0},
                {"theorem_text": "כל נקודה על חוצה זווית נמצאת במרחקים שווים משוקי זווית זו", "category": 0},
                {
                    "theorem_text": "חוצה זווית פנימית במשולש מחלק את הצלע שמול הזווית לשני קטעים ביחס שווה ליחס הצלעות הכולאות את הזווית בהתאמה",
                    "category": 0},
                {"theorem_text": "קטע אמצעים במשולש מקביל לצלע השלישית ושווה למחציתה", "category": 0},
                {"theorem_text": "ישר החוצה צלע אחת במשולש ומקביל לצלע שניה, חוצה את הצלע השלישית", "category": 0},
                {"theorem_text": "קטע שקצותיו על שתי צלעות משולש, מקביל לצלע השלישית ושווה למחציתה הוא קטע אמצעים",
                 "category": 0},
                {
                    "theorem_text": "צ.צ.צ  - אם כל שלוש הצלעות של משולש אחד שוות לצלעות המתאימות של משולש אחר, המשולשים חופפים",
                    "category": 0},
                {
                    "theorem_text": "צ.ז.צ - אם שתי צלעות והזווית הכלולה של משולש אחד שווים לצלעות המתאימות ולזווית הכלולה של משולש אחר, המשולשים חופפים",
                    "category": 0},
                {
                    "theorem_text": "ז.צ.ז - אם שתי זוויות והצלע הכלולה של משולש אחד שווים לזוויות המתאימות ולצלע הכלולה של משולש אחר, המשולשים חופפים",
                    "category": 0},
                {"theorem_text": "צ.צ.צ - שני משולשים דומים אם היחס בין הצלעות המתאימות שלהם שווה", "category": 0},
                {"theorem_text": "ז.ז - שני משולשים דומים אם יש להם שתי זוויות מתאימות שוות", "category": 0},
                {
                    "theorem_text": "צ.ז.צ - שני משולשים דומים אם יש להם שתי צלעות שוות, והזווית שבין הצלעות יחסית בין המשולשים שווה",
                    "category": 0},
                {"theorem_text": "במשולשים דומים, יחס גבהים מתאימים שווה ליחס הדמיון", "category": 0},
                {"theorem_text": "במשולשים דומים, יחס חוצי זוויות מתאימות שווה ליחס הדמיון", "category": 0},
                {"theorem_text": "במשולשים דומים, יחס תיכונים מתאימים שווה ליחס הדמיון", "category": 0},
                {"theorem_text": "במשולשים דומים, יחס ההיקפים שווה ליחס הדמיון", "category": 0},
                {"theorem_text": "במשולשים דומים, יחס השטחים שווה לריבוע יחס הדמיון", "category": 0},
                {"theorem_text": "משולש בעל זווית אחת בדיוק של 90°  הוא משולש ישר זוית (בהגדרה)", "category": 3},
                {"theorem_text": "במשולש ישר זוית, הצלע המנוגדת לזווית הישרה נקראת יתר והיא תמיד הצלע הארוכה ביותר",
                 "category": 3},
                {"theorem_text": "משפט פיתגורס: במשולש ישר זווית, סכום ריבועי הניצבים שווה לריבוע היתר", "category": 3},
                {
                    "theorem_text": "משפט פיתגורס ההפוך: משולש בו סכום ריבועי שתי צלעות שווה לריבוע הצלע השלישית הוא ישר זווית",
                    "category": 3},
                {"theorem_text": "אם במשולש ישר זווית, זווית חדה של 30 מעלות, אז הניצב מול זווית זו שווה למחצית היתר",
                 "category": 3},
                {"theorem_text": "אם במשולש ישר זווית ניצב שווה למחצית היתר, אז מול ניצב זה זווית שגודלה 30 מעלות",
                 "category": 3},
                {"theorem_text": "במשולש ישר זווית, הניצב הוא ממוצע הנדסי של היתר והיטל ניצב זה על היתר",
                 "category": 3},
                {"theorem_text": "במשולש ישר זווית, אם זווית אחת היא 30°, השנייה היא 60°", "category": 3},
                {"theorem_text": "במושלש ישר זווית, אם שתי הזוויות הלא ישרות שוות, כל אחת מהן היא 45°", "category": 3},
                {"theorem_text": "במשולש ישר זווית, גובה ליתר יוצר שני משולשים הדומים למשולש המקורי", "category": 3},
                {"theorem_text": "במשולש ישר זווית, גובה ליתר יוצר שני משולשים הדומים זה לזה", "category": 3},
                {"theorem_text": "הגובה ליתר במשולש ישר זווית הוא ממוצע הנדסי של היטלי הניצבים על היתר", "category": 3},
                {"theorem_text": "במשולש ישר זווית התיכון ליתר שווה למחצית היתר", "category": 3},
                {"theorem_text": "משולש בו התיכון שווה למחצית הצלע אותה הוא חוצה הוא משולש ישר זווית", "category": 3},
                {"theorem_text": "עבור משולשים 30-60-90: הצלעות הן ביחס X : X·√3 : 2X", "category": 3}
,
                {"theorem_text": "עבור משולשים 45-45-90: הצלעות הן ביחס X : X : X·√2", "category": 3}
,
                {"theorem_text": "9.	אם במשולש גובה הוא תיכון, אז המשולש הוא שווה שוקיים",
                 "category": 2},
                {"theorem_text": "במשולש שווה שוקיים, זוויות הבסיס שוות זו לזו", "category": 2},
                {"theorem_text": "במשולש שווה שוקיים, חוצה זווית הראש, התיכון לבסיס והגובה לבסיס מתלכדים",
                 "category": 2},
                {"theorem_text": "אם במשולש חוצה זווית הוא גובה, אז המשולש הוא שווה שוקיים", "category": 2},
                {"theorem_text": "אם במשולש חוצה זווית הוא תיכון, אז המשולש הוא שווה שוקיים", "category": 2},
                {"theorem_text": "ישר העובר דרך קדקוד משולש ומחלק את הצלע שמול קדקוד זה חלוקה פנימית, ביחס של שתי הצלעות האחרות (בהתאמה) הוא חוצה את זווית המשולש שדרך קודקודה הוא עובר ",
                 "category": 2},
                {"theorem_text": "משולש שבו כל שלוש הצלעות שוות באורכן, הוא משולש שווה צלעות (הגדרה)", "category": 1},
                {"theorem_text": "במשולש שווה צלעות, כל שלושת הזוויות במשולש שוות ל-60°", "category": 1},
                {"theorem_text": "במשולש שווה צלעות, שלושת התיכונים שווים באורכם", "category": 1},
                {"theorem_text": "כל שלושת הגבהים במשולש שווה צלעות שווים באורכם", "category": 1},
                {"theorem_text": "כל שלושת חוצי הזוויות במשולש שווה צלעות שווים באורכם", "category": 1},
                {"theorem_text": "כל חוצי הזוויות שמחלקים את הזוויות הפנימיות של המשולש שווים", "category": 1},
                {"theorem_text": "המרכזים של התיכונים, הגבהים וחוצי הזוויות נפגשים כולם בנקודה אחת", "category": 1},
                {"theorem_text": "משפט חפיפה שתי צלעות והזווית שמול הצלע הגדולה מבין השתיים", "category": 0},
            ])
            print("✅ הנתונים לטבלת Theorems הוזנו בהצלחה!")
        else:
            print("⚠️ הנתונים בטבלת Theorems כבר קיימים.")


def insert_theorem_triangle_matrix():
    TheoremTriangleMatrix = metadata.tables["TheoremTriangleMatrix"]
    with engine.begin() as conn:  # ✅ שימוש בטרנזקציה
        existing = conn.execute(select(TheoremTriangleMatrix)).fetchall()
        if not existing:
            TheoremTriangleMatrixData = [
                # -- Theorems 1 - 10
                (1, 0, 1.0), (1, 1, 1.0), (1, 2, 1.0), (1, 3, 1.0),
                (2, 0, 1.0), (2, 1, 1.0), (2, 2, 1.0), (2, 3, 1.0),
                (3, 0, 1.0), (3, 1, 1.0), (3, 2, 1.0), (3, 3, 1.0),
                (4, 0, 1.0), (4, 1, 1.0), (4, 2, 1.0), (4, 3, 1.0),
                (5, 0, 1.0), (5, 1, 0.1), (5, 2, 1.0), (5, 3, 1.0),
                (6, 0, 1.0), (6, 1, 1.0), (6, 2, 1.0), (6, 3, 1.0),
                (7, 0, 1.0), (7, 1, 0.1), (7, 2, 1.0), (7, 3, 1.0),
                (8, 0, 1.0), (8, 1, 1.0), (8, 2, 1.0), (8, 3, 1.0),
                (9, 0, 1.0), (9, 1, 1.0), (9, 2, 1.0), (9, 3, 1.0),
                (10, 0, 1.0), (10, 1, 1.0), (10, 2, 1.0), (10, 3, 1.0),

                # -- Theorems 11 - 20
                (11, 0, 1.0), (11, 1, 1.0), (11, 2, 1.0), (11, 3, 1.0),
                (12, 0, 1.0), (12, 1, 1.0), (12, 2, 1.0), (12, 3, 1.0),
                (13, 0, 1.0), (13, 1, 1.0), (13, 2, 1.0), (13, 3, 1.0),
                (14, 0, 1.0), (14, 1, 1.0), (14, 2, 1.0), (14, 3, 1.0),
                (15, 0, 1.0), (15, 1, 1.0), (15, 2, 1.0), (15, 3, 1.0),
                (16, 0, 1.0), (16, 1, 1.0), (16, 2, 1.0), (16, 3, 1.0),
                (17, 0, 1.0), (17, 1, 1.0), (17, 2, 1.0), (17, 3, 1.0),
                (18, 0, 1.0), (18, 1, 1.0), (18, 2, 1.0), (18, 3, 1.0),
                (19, 0, 1.0), (19, 1, 1.0), (19, 2, 1.0), (19, 3, 1.0),
                (20, 0, 1.0), (20, 1, 1.0), (20, 2, 1.0), (20, 3, 1.0),

                # -- Theorems 21 - 30
                (21, 0, 1.0), (21, 1, 1.0), (21, 2, 1.0), (21, 3, 1.0),
                (22, 0, 1.0), (22, 1, 1.0), (22, 2, 1.0), (22, 3, 1.0),
                (23, 0, 1.0), (23, 1, 1.0), (23, 2, 1.0), (23, 3, 1.0),
                (24, 0, 1.0), (24, 1, 1.0), (24, 2, 1.0), (24, 3, 1.0),
                (25, 0, 1.0), (25, 1, 1.0), (25, 2, 1.0), (25, 3, 1.0),
                (26, 0, 1.0), (26, 1, 1.0), (26, 2, 1.0), (26, 3, 1.0),
                (27, 0, 1.0), (27, 1, 1.0), (27, 2, 1.0), (27, 3, 1.0),
                (28, 0, 1.0), (28, 1, 1.0), (28, 2, 1.0), (28, 3, 1.0),
                (29, 0, 1.0), (29, 1, 1.0), (29, 2, 1.0), (29, 3, 1.0),
                (30, 0, 1.0), (30, 1, 1.0), (30, 2, 1.0), (30, 3, 1.0),

                # -- Theorems 31 - 40
                (31, 0, 0.0), (31, 1, 0.0), (31, 2, 0.0), (31, 3, 1.0),
                (32, 0, 1.0), (32, 1, 1.0), (32, 2, 1.0), (32, 3, 1.0),
                (33, 0, 1.0), (33, 1, 1.0), (33, 2, 1.0), (33, 3, 1.0),
                (34, 0, 0.1), (34, 1, 0.0), (34, 2, 0.5), (34, 3, 1.0),
                (35, 0, 0.1), (35, 1, 0.0), (35, 2, 0.5), (35, 3, 1.0),
                (36, 0, 0.1), (36, 1, 0.0), (36, 2, 0.5), (36, 3, 1.0),
                (37, 0, 0.1), (37, 1, 0.0), (37, 2, 0.5), (37, 3, 1.0),
                (38, 0, 0.0), (38, 1, 0.0), (38, 2, 0.0), (38, 3, 1.0),
                (39, 0, 0.0), (39, 1, 0.0), (39, 2, 0.0), (39, 3, 1.0),
                (40, 0, 0.1), (40, 1, 0.0), (40, 2, 0.5), (40, 3, 1.0),

                # -- Theorems 41 - 50
                (41, 0, 0.1), (41, 1, 0.0), (41, 2, 0.0), (41, 3, 1.0),
                (42, 0, 0.1), (42, 1, 0.0), (42, 2, 0.55), (42, 3, 1.0),
                (43, 0, 0.0), (43, 1, 0.0), (43, 2, 0.5), (43, 3, 1.0),
                (44, 0, 0.0), (44, 1, 0.0), (44, 2, 0.5), (44, 3, 1.0),
                (45, 0, 0.0), (45, 1, 0.0), (45, 2, 0.5), (45, 3, 1.0),
                (46, 0, 0.0), (46, 1, 0.0), (46, 2, 0.5), (46, 3, 1.0),
                (47, 0, 0.0), (47, 1, 0.0), (47, 2, 0.5), (47, 3, 1.0),
                (48, 0, 0.0), (48, 1, 0.0), (48, 2, 0.0), (48, 3, 1.0),
                (49, 0, 0.0), (49, 1, 0.0), (49, 2, 1.0), (49, 3, 1.0),
                (50, 0, 0.1), (50, 1, 1.0), (50, 2, 1.0), (50, 3, 0.5),

                # -- Theorems 51 - 60
                (51, 0, 0.1), (51, 1, 0.7), (51, 2, 1.0), (51, 3, 0.5),
                (52, 0, 0.1), (52, 1, 1.0), (52, 2, 1.0), (52, 3, 0.5),
                (53, 0, 0.1), (53, 1, 0.7), (53, 2, 1.0), (53, 3, 0.5),
                (54, 0, 0.1), (54, 1, 0.7), (54, 2, 1.0), (54, 3, 0.5),
                (55, 0, 1.0), (55, 1, 1.0), (55, 2, 1.0), (55, 3, 1.0),
                (56, 0, 0.1), (56, 1, 1.0), (56, 2, 0.0), (56, 3, 0.0),
                (57, 0, 0.1), (57, 1, 1.0), (57, 2, 0.0), (57, 3, 0.0),
                (58, 0, 0.1), (58, 1, 1.0), (58, 2, 0.0), (58, 3, 0.0),
                (59, 0, 0.1), (59, 1, 1.0), (59, 2, 0.0), (59, 3, 0.0),
                (60, 0, 0.1), (60, 1, 1.0), (60, 2, 0.0), (60, 3, 0.0),

                # -- Theorems 61 - 63
                (61, 0, 0.1), (61, 1, 1.0), (61, 2, 0.0), (61, 3, 0.0),
                (62, 0, 0.1), (62, 1, 1.0), (62, 2, 0.0), (62, 3, 0.0),
                (63, 0, 1.0), (63, 1, 1.0), (63, 2, 1.0), (63, 3, 1.0)

            ]
            records = [
                {"theorem_id": tid, "triangle_id": trid, "connection_strength": strength}
                for tid, trid, strength in TheoremTriangleMatrixData
            ]
            conn.execute(insert(TheoremTriangleMatrix), records)
            print("✅ הנתונים הוזנו לטבלת TheoremTriangleMatrix")
        else:
            print("⚠️ הנתונים כבר קיימים בטבלה")









# הכנסת נתונים לטבלת השאלות
def insert_questions():
    Questions = metadata.tables["Questions"]
    with engine.begin() as conn:
        existing_questions = conn.execute(select(Questions)).fetchall()
        if not existing_questions:
            conn.execute(insert(Questions), [
                {"question_text": "האם למשולש יש זווית בת 30 מעלות?", "difficulty_level": 1},
                {"question_text": "האם למשולש יש זווית בת 60 מעלות?", "difficulty_level": 1},
                {"question_text": "האם למשולש יש זווית בת 90 מעלות?", "difficulty_level": 1},
                {"question_text": "האם כל זוויות המשולש שוות בגודלן?", "difficulty_level": 1},
                {"question_text": "האם כל צלעות המשולש שוות באורכן?", "difficulty_level": 1},
                {"question_text": "האם בדיוק שתי צלעות שוות באורכן?", "difficulty_level": 1},
                {"question_text": "האם הזוויות הבסיס שוות זו לזו?", "difficulty_level": 1},
                {"question_text": "האם למשולש יש זווית גדולה מ- 90 מעלות?", "difficulty_level": 1},
                {"question_text": "האם יש גובה מחוץ למשולש?", "difficulty_level": 1},
                {"question_text": "האם אתה זוכר מהו סכום הזוויות הפניומיות במשולש?", "difficulty_level": 1},
                {"question_text": "האם אתה זוכר מהו הקשר בין זווית חיצונית למשולש לבין זוויות פנימיות במשולש?",
                 "difficulty_level": 2},
                {"question_text": "האם אתה יודע מה הקשר בין הזווית הגדולה במשולש לבין הצלע הגדולה במשולש?",
                 "difficulty_level": 2},
                {"question_text": "האם השתמשת במשפט תאלס?", "difficulty_level": 2},
                {"question_text": "האם סכום ריבועי שתי הצלעות הקצרות במשולש, שווה לריבוע הצלע השלישית?",
                 "difficulty_level": 2},
                {"question_text": "האם הצלע הנגדית לזווית של 30 מעלות שווה למחצית הצלע הארוכה ביותר?",
                 "difficulty_level": 2},
                {"question_text": "האם הצלע הקצרה ביותר היא מחצית מאורך הצלע הארוכה ביותר?", "difficulty_level": 2},
                {"question_text": "האם הגובה לצלע הארוכה ביותר יוצר שני משולשים הדומים למשולש המקורי?",
                 "difficulty_level": 2},
                {"question_text": "האם הקו מהזווית הישרה לאמצע הצלע הארוכה ביותר שווה למחצית מאורך הצלע?",
                 "difficulty_level": 2},
                {"question_text": "האם הגובה לבסיס חוצה אותו?", "difficulty_level": 2},
                {"question_text": "האם חוצה זווית הראש חוצה את הבסיס?", "difficulty_level": 2},
                {"question_text": "האם חוצה זווית הראש מאונך לבסיס?", "difficulty_level": 3},
                {"question_text": "האם חוצה הזווית של זווית הקודקוד יוצר שני משולשים חופפים?", "difficulty_level": 3},
                {"question_text": "האם כל שלושת הגבהים שווים באורכם?", "difficulty_level": 3},
                {"question_text": "האם כל שלושת התיכונים שווים באורכם?", "difficulty_level": 3},
                {"question_text": "האם כל שלושת חוצי הזווית שווים באורכם?", "difficulty_level": 3},
                {"question_text": "האם כל שלושת הגבהים מצטלבים באותה נקודה?", "difficulty_level": 3},
                {"question_text": "האם כל שלושת התיכונים מצטלבים באותה נקודה?", "difficulty_level": 3},
                {"question_text": "האם כל שלושת חוצי הזווית מצטלבים באותה נקודה?", "difficulty_level": 3}
            ])
            print("✅ הנתונים לטבלת Questions הוזנו בהצלחה!")
        else:
            print("⚠️ הנתונים בטבלת Questions כבר קיימים.")

# הכנסת נתונים לטבלת TheoremQuestionMatrix מקובץ CSV
def insert_theorem_question_matrix():
    TheoremQuestionMatrix = metadata.tables["TheoremQuestionMatrix"]
    file_path = "C:/Users/97253/PycharmProjects/Geometry/Questions-Theorems.csv"
    df = pd.read_csv(file_path)

    with engine.begin() as conn:
        for _, row in df.iterrows():
            conn.execute(insert(TheoremQuestionMatrix).values(
                question_id=int(row['question_id']),
                theorem_id=int(row['theorem_id'])
            ))
        print("✅ הנתונים לטבלת TheoremQuestionMatrix הוזנו בהצלחה!")

# הכנסת אפשרויות תשובה
def insert_answers():
    InputDuring = metadata.tables["inputDuring"]
    with engine.begin() as conn:
        existing_inputs = conn.execute(select(InputDuring)).fetchall()
        if not existing_inputs:
            conn.execute(insert(InputDuring), [
                {"ansID": 0, "ans": "לא"},
                {"ansID": 1, "ans": "כן"},
                {"ansID": 2, "ans": "לא יודע"},
                {"ansID": 3, "ans": "כנראה"}
            ])
            print("✅ הנתונים לטבלת inputDuring הוזנו בהצלחה!")




   ## טבלת מכפילים התחלתית וקשיחה מהפרוייקט של הבנות
   ##-- Insert to Answer InitialAnswerMultipliers
   ##מטרתה: להשפיע על הרלוונטיות של סוגי משולשים (ולא משפטים!) בהתאם לתשובות של המשתמש לשאלות פתיחה.
def insert_initial_answer_multipliers():
    InitialAnswerMultipliers = metadata.tables["InitialAnswerMultipliers"]
    with engine.begin() as conn:  # ✅ שימוש בטרנזקציה
        existing = conn.execute(select(InitialAnswerMultipliers)).fetchall()
        if not existing:
            InitialAnswerMultipliersData= [
                ## Question 1
                (1, 0, 'כן', 1.0), (1, 1, 'כן', 0.05), (1, 2, 'כן', 1.2), (1, 3, 'כן', 1.2),
                (1, 0, 'לא', 1.2), (1, 1, 'לא', 1.5), (1, 2, 'לא', 1.0), (1, 3, 'לא', 1.0),
                (1, 0, 'לא יודע', 1.0), (1, 1, 'לא יודע', 1.0), (1, 2, 'לא יודע', 1.0), (1, 3, 'לא יודע', 1.0),
                (1, 0, 'כנראה', 1.0), (1, 1, 'כנראה', 0.5), (1, 2, 'כנראה', 1.1), (1, 3, 'כנראה', 1.0),
                ## Question 2
                (2, 0, 'כן', 1.0), (2, 1, 'כן', 1.3), (2, 2, 'כן', 1.2), (2, 3, 'כן', 1.2),
                (2, 0, 'לא', 1.2), (2, 1, 'לא', 0.05), (2, 2, 'לא', 1.0), (2, 3, 'לא', 1.0),
                (2, 0, 'לא יודע', 1.0), (2, 1, 'לא יודע', 1.0), (2, 2, 'לא יודע', 1.0), (2, 3, 'לא יודע', 1.0),
                (2, 0, 'כנראה', 1.0), (2, 1, 'כנראה', 1.1), (2, 2, 'כנראה', 1.1), (2, 3, 'כנראה', 1.1),
                ## Question 3
                (3, 0, 'כן', 0.5), (3, 1, 'כן', 0.05), (3, 2, 'כן', 1.0), (3, 3, 'כן', 10.0),
                (3, 0, 'לא', 1.3), (3, 1, 'לא', 1.1), (3, 2, 'לא', 1.2), (3, 3, 'לא', 0.01),
                (3, 0, 'לא יודע', 1.0), (3, 1, 'לא יודע', 1.0), (3, 2, 'לא יודע', 1.0), (3, 3, 'לא יודע', 1.0),
                (3, 0, 'כנראה', 0.8), (3, 1, 'כנראה', 0.3), (3, 2, 'כנראה', 1.0), (3, 3, 'כנראה', 1.5),

                ## Question 4
                (4, 0, 'כן', 0.2), (4, 1, 'כן', 1000.0), (4, 2, 'כן', 0.03), (4, 3, 'כן', 0.001),
                (4, 0, 'לא', 1.2), (4, 1, 'לא', 0.001), (4, 2, 'לא', 1.1), (4, 3, 'לא', 1.1),
                (4, 0, 'לא יודע', 1.0), (4, 1, 'לא יודע', 1.0), (4, 2, 'לא יודע', 1.0), (4, 3, 'לא יודע', 1.0),
                (4, 0, 'כנראה', 0.7), (4, 1, 'כנראה', 1.5), (4, 2, 'כנראה', 0.5), (4, 3, 'כנראה', 0.5),

                ## Question 5
                (5, 0, 'כן', 0.2), (5, 1, 'כן', 1000.0), (5, 2, 'כן', 0.05), (5, 3, 'כן', 0.001),
                (5, 0, 'לא', 1.2), (5, 1, 'לא', 0.001), (5, 2, 'לא', 1.1), (5, 3, 'לא', 1.1),
                (5, 0, 'לא יודע', 1.0), (5, 1, 'לא יודע', 1.0), (5, 2, 'לא יודע', 1.0), (5, 3, 'לא יודע', 1.0),
                (5, 0, 'כנראה', 0.7), (5, 1, 'כנראה', 1.5), (5, 2, 'כנראה', 0.5), (5, 3, 'כנראה', 0.5),

                ## Question 6
                (6, 0, 'כן', 0.3), (6, 1, 'כן', 0.05), (6, 2, 'כן', 1000.0), (6, 3, 'כן', 0.5),
                (6, 0, 'לא', 1.2), (6, 1, 'לא', 1.1), (6, 2, 'לא', 0.05), (6, 3, 'לא', 1.0),
                (6, 0, 'לא יודע', 1.0), (6, 1, 'לא יודע', 1.0), (6, 2, 'לא יודע', 1.0), (6, 3, 'לא יודע', 1.0),
                (6, 0, 'כנראה', 0.7), (6, 1, 'כנראה', 0.5), (6, 2, 'כנראה', 1.5), (6, 3, 'כנראה', 1.0),

                ## Question 7
                (7, 0, 'כן', 0.3), (7, 1, 'כן', 0.05), (7, 2, 'כן', 1000.0), (7, 3, 'כן', 1.2),
                (7, 0, 'לא', 1.2), (7, 1, 'לא', 1.1), (7, 2, 'לא', 0.05), (7, 3, 'לא', 1.0),
                (7, 0, 'לא יודע', 1.0), (7, 1, 'לא יודע', 1.0), (7, 2, 'לא יודע', 1.0), (7, 3, 'לא יודע', 1.0),
                (7, 0, 'כנראה', 0.7), (7, 1, 'כנראה', 0.5), (7, 2, 'כנראה', 1.5), (7, 3, 'כנראה', 1.0),

                ## Question 8
                (8, 0, 'כן', 1.3), (8, 1, 'כן', 0.001), (8, 2, 'כן', 1.3), (8, 3, 'כן', 0.001),
                (8, 0, 'לא', 0.9), (8, 1, 'לא', 1.2), (8, 2, 'לא', 1.2), (8, 3, 'לא', 1.2),
                (8, 0, 'לא יודע', 1.0), (8, 1, 'לא יודע', 1.0), (8, 2, 'לא יודע', 1.0), (8, 3, 'לא יודע', 1.0),
                (8, 0, 'כנראה', 1.1), (8, 1, 'כנראה', 0.5), (8, 2, 'כנראה', 1.1), (8, 3, 'כנראה', 0.5),

                ## Question 9
                (9, 0, 'כן', 1.1), (9, 1, 'כן', 0.01), (9, 2, 'כן', 1.1), (9, 3, 'כן', 0.01),
                (9, 0, 'לא', 1.0), (9, 1, 'לא', 1.5), (9, 2, 'לא', 1.0), (9, 3, 'לא', 1.5),
                (9, 0, 'לא יודע', 1.0), (9, 1, 'לא יודע', 1.0), (9, 2, 'לא יודע', 1.0), (9, 3, 'לא יודע', 1.0),
                (9, 0, 'כנראה', 1.1), (9, 1, 'כנראה', 0.7), (9, 2, 'כנראה', 1.1), (9, 3, 'כנראה', 0.7),

                ## Question 10
                (10, 0, 'כן', 1.0), (10, 1, 'כן', 1.0), (10, 2, 'כן', 1.0), (10, 3, 'כן', 1.0),
                (10, 0, 'לא', 1.0), (10, 1, 'לא', 1.0), (10, 2, 'לא', 1.0), (10, 3, 'לא', 1.0),
                (10, 0, 'לא יודע', 1.0), (10, 1, 'לא יודע', 1.0), (10, 2, 'לא יודע', 1.0), (10, 3, 'לא יודע', 1.0),
                (10, 0, 'כנראה', 1.0), (10, 1, 'כנראה', 1.0), (10, 2, 'כנראה', 1.0), (10, 3, 'כנראה', 1.0),

                ## Question 11
                (11, 0, 'כן', 1.0), (11, 1, 'כן', 1.0), (11, 2, 'כן', 1.0), (11, 3, 'כן', 1.0),
                (11, 0, 'לא', 1.0), (11, 1, 'לא', 1.0), (11, 2, 'לא', 1.0), (11, 3, 'לא', 1.0),
                (11, 0, 'לא יודע', 1.0), (11, 1, 'לא יודע', 1.0), (11, 2, 'לא יודע', 1.0), (11, 3, 'לא יודע', 1.0),
                (11, 0, 'כנראה', 1.0), (11, 1, 'כנראה', 1.0), (11, 2, 'כנראה', 1.0), (11, 3, 'כנראה', 1.0),

                ## Question 12
                (12, 0, 'כן', 1.0), (12, 1, 'כן', 1.0), (12, 2, 'כן', 1.0), (12, 3, 'כן', 1.0),
                (12, 0, 'לא', 1.0), (12, 1, 'לא', 1.0), (12, 2, 'לא', 1.0), (12, 3, 'לא', 1.0),
                (12, 0, 'לא יודע', 1.0), (12, 1, 'לא יודע', 1.0), (12, 2, 'לא יודע', 1.0), (12, 3, 'לא יודע', 1.0),
                (12, 0, 'כנראה', 1.0), (12, 1, 'כנראה', 1.0), (12, 2, 'כנראה', 1.0), (12, 3, 'כנראה', 1.0),

                ## Question 13
                (13, 0, 'כן', 1.0), (13, 1, 'כן', 1.0), (13, 2, 'כן', 1.0), (13, 3, 'כן', 1.0),
                (13, 0, 'לא', 1.0), (13, 1, 'לא', 1.0), (13, 2, 'לא', 1.0), (13, 3, 'לא', 1.0),
                (13, 0, 'לא יודע', 1.0), (13, 1, 'לא יודע', 1.0), (13, 2, 'לא יודע', 1.0), (13, 3, 'לא יודע', 1.0),
                (13, 0, 'כנראה', 1.0), (13, 1, 'כנראה', 1.0), (13, 2, 'כנראה', 1.0), (13, 3, 'כנראה', 1.0),

                ## Question 14
                (14, 0, 'כן', 0.5), (14, 1, 'כן', 0.05), (14, 2, 'כן', 1.2), (14, 3, 'כן', 10.0),
                (14, 0, 'לא', 1.3), (14, 1, 'לא', 1.2), (14, 2, 'לא', 1.1), (14, 3, 'לא', 0.05),
                (14, 0, 'לא יודע', 1.0), (14, 1, 'לא יודע', 1.0), (14, 2, 'לא יודע', 1.0), (14, 3, 'לא יודע', 1.0),
                (14, 0, 'כנראה', 0.8), (14, 1, 'כנראה', 0.3), (14, 2, 'כנראה', 1.0), (14, 3, 'כנראה', 1.5),

                ## Question 15
                (15, 0, 'כן', 0.3), (15, 1, 'כן', 0.05), (15, 2, 'כן', 0.05), (15, 3, 'כן', 10.0),
                (15, 0, 'לא', 1.0), (15, 1, 'לא', 1.0), (15, 2, 'לא', 1.0), (15, 3, 'לא', 1.0),
                (15, 0, 'לא יודע', 1.0), (15, 1, 'לא יודע', 1.0), (15, 2, 'לא יודע', 1.0), (15, 3, 'לא יודע', 1.0),
                (15, 0, 'כנראה', 0.8), (15, 1, 'כנראה', 0.3), (15, 2, 'כנראה', 0.3), (15, 3, 'כנראה', 1.5),

                ## Question 16

                (16, 0, 'כן', 1.0), (16, 1, 'כן', 0.05), (16, 2, 'כן', 0.5), (16, 3, 'כן', 1.7),
                (16, 0, 'לא', 1.0), (16, 1, 'לא', 1.0), (16, 2, 'לא', 1.0), (16, 3, 'לא', 1.0),
                (16, 0, 'לא יודע', 1.0), (16, 1, 'לא יודע', 1.0), (16, 2, 'לא יודע', 1.0), (16, 3, 'לא יודע', 1.0),
                (16, 0, 'כנראה', 0.8), (16, 1, 'כנראה', 0.3), (16, 2, 'כנראה', 0.3), (16, 3, 'כנראה', 1.5),

                ## Question 17

                (17, 0, 'כן', 0.5), (17, 1, 'כן', 0.005), (17, 2, 'כן', 1.2), (17, 3, 'כן', 10.0),
                (17, 0, 'לא', 1.3), (17, 1, 'לא', 1.2), (17, 2, 'לא', 1.1), (17, 3, 'לא', 0.05),
                (17, 0, 'לא יודע', 1.0), (17, 1, 'לא יודע', 1.0), (17, 2, 'לא יודע', 1.0), (17, 3, 'לא יודע', 1.0),
                (17, 0, 'כנראה', 0.8), (17, 1, 'כנראה', 0.3), (17, 2, 'כנראה', 1.0), (17, 3, 'כנראה', 1.5),

                ## Question 18

                (18, 0, 'כן', 0.5), (18, 1, 'כן', 0.005), (18, 2, 'כן', 1.2), (18, 3, 'כן', 10.0),
                (18, 0, 'לא', 1.3), (18, 1, 'לא', 1.2), (18, 2, 'לא', 1.1), (18, 3, 'לא', 0.05),
                (18, 0, 'לא יודע', 1.0), (18, 1, 'לא יודע', 1.0), (18, 2, 'לא יודע', 1.0), (18, 3, 'לא יודע', 1.0),
                (18, 0, 'כנראה', 0.8), (18, 1, 'כנראה', 0.3), (18, 2, 'כנראה', 1.0), (18, 3, 'כנראה', 1.5),

                ## Question 19

                (19, 0, 'כן', 0.3), (19, 1, 'כן', 1.3), (19, 2, 'כן', 3.0), (19, 3, 'כן', 1.0),
                (19, 0, 'לא', 1.2), (19, 1, 'לא', 0.05), (19, 2, 'לא', 0.05), (19, 3, 'לא', 1.0),
                (19, 0, 'לא יודע', 1.0), (19, 1, 'לא יודע', 1.0), (19, 2, 'לא יודע', 1.0), (19, 3, 'לא יודע', 1.0),
                (19, 0, 'כנראה', 0.7), (19, 1, 'כנראה', 1.15), (19, 2, 'כנראה', 1.5), (19, 3, 'כנראה', 1.0),

                ## Question 20

                (20, 0, 'כן', 0.3), (20, 1, 'כן', 1.3), (20, 2, 'כן', 3.0), (20, 3, 'כן', 1.0),
                (20, 0, 'לא', 1.2), (20, 1, 'לא', 0.1), (20, 2, 'לא', 0.1), (20, 3, 'לא', 1.0),
                (20, 0, 'לא יודע', 1.0), (20, 1, 'לא יודע', 1.0), (20, 2, 'לא יודע', 1.0), (20, 3, 'לא יודע', 1.0),
                (20, 0, 'כנראה', 0.7), (20, 1, 'כנראה', 1.15), (20, 2, 'כנראה', 1.5), (20, 3, 'כנראה', 1.0),

                ## Question 21

                (21, 0, 'כן', 0.3), (21, 1, 'כן', 1.5), (21, 2, 'כן', 3.0), (21, 3, 'כן', 1.0),
                (21, 0, 'לא', 1.2), (21, 1, 'לא', 0.1), (21, 2, 'לא', 0.1), (21, 3, 'לא', 1.0),
                (21, 0, 'לא יודע', 1.0), (21, 1, 'לא יודע', 1.0), (21, 2, 'לא יודע', 1.0), (21, 3, 'לא יודע', 1.0),
                (21, 0, 'כנראה', 0.7), (21, 1, 'כנראה', 1.2), (21, 2, 'כנראה', 1.6), (21, 3, 'כנראה', 1.0),

                ## Question 22

                (22, 0, 'כן', 0.3), (22, 1, 'כן', 1.5), (22, 2, 'כן', 3.0), (22, 3, 'כן', 1.0),
                (22, 0, 'לא', 1.2), (22, 1, 'לא', 0.1), (22, 2, 'לא', 0.1), (22, 3, 'לא', 1.0),
                (22, 0, 'לא יודע', 1.0), (22, 1, 'לא יודע', 1.0), (22, 2, 'לא יודע', 1.0), (22, 3, 'לא יודע', 1.0),
                (22, 0, 'כנראה', 0.7), (22, 1, 'כנראה', 0.2), (22, 2, 'כנראה', 1.5), (22, 3, 'כנראה', 1.0),

                ## Question 23

                (23, 0, 'כן', 0.2), (23, 1, 'כן', 100.0), (23, 2, 'כן', 0.9), (23, 3, 'כן', 0.01),
                (23, 0, 'לא', 1.2), (23, 1, 'לא', 0.01), (23, 2, 'לא', 1.1), (23, 3, 'לא', 1.1),
                (23, 0, 'לא יודע', 1.0), (23, 1, 'לא יודע', 1.0), (23, 2, 'לא יודע', 1.0), (23, 3, 'לא יודע', 1.0),
                (23, 0, 'כנראה', 0.7), (23, 1, 'כנראה', 1.5), (23, 2, 'כנראה', 1.0), (23, 3, 'כנראה', 0.5),

                ## Question 24

                (24, 0, 'כן', 0.2), (24, 1, 'כן', 100.0), (24, 2, 'כן', 0.9), (24, 3, 'כן', 0.01),
                (24, 0, 'לא', 1.2), (24, 1, 'לא', 0.01), (24, 2, 'לא', 1.1), (24, 3, 'לא', 1.1),
                (24, 0, 'לא יודע', 1.0), (24, 1, 'לא יודע', 1.0), (24, 2, 'לא יודע', 1.0), (24, 3, 'לא יודע', 1.0),
                (24, 0, 'כנראה', 0.7), (24, 1, 'כנראה', 1.5), (24, 2, 'כנראה', 1.0), (24, 3, 'כנראה', 0.5),

                ## Question 25

                (25, 0, 'כן', 0.2), (25, 1, 'כן', 100.0), (25, 2, 'כן', 0.9), (25, 3, 'כן', 0.01),
                (25, 0, 'לא', 1.2), (25, 1, 'לא', 0.01), (25, 2, 'לא', 1.1), (25, 3, 'לא', 1.1),
                (25, 0, 'לא יודע', 1.0), (25, 1, 'לא יודע', 1.0), (25, 2, 'לא יודע', 1.0), (25, 3, 'לא יודע', 1.0),
                (25, 0, 'כנראה', 0.7), (25, 1, 'כנראה', 1.5), (25, 2, 'כנראה', 1.0), (25, 3, 'כנראה', 0.5),

                ## Question 26

                (26, 0, 'כן', 1.0), (26, 1, 'כן', 1.0), (26, 2, 'כן', 1.0), (26, 3, 'כן', 1.0),
                (26, 0, 'לא', 1.0), (26, 1, 'לא', 1.0), (26, 2, 'לא', 1.0), (26, 3, 'לא', 1.0),
                (26, 0, 'לא יודע', 1.0), (26, 1, 'לא יודע', 1.0), (26, 2, 'לא יודע', 1.0), (26, 3, 'לא יודע', 1.0),
                (26, 0, 'כנראה', 1.0), (26, 1, 'כנראה', 1.0), (26, 2, 'כנראה', 1.0), (26, 3, 'כנראה', 1.0),

                ## Question 27

                (27, 0, 'כן', 1.0), (27, 1, 'כן', 1.0), (27, 2, 'כן', 1.0), (27, 3, 'כן', 1.0),
                (27, 0, 'לא', 1.0), (27, 1, 'לא', 1.0), (27, 2, 'לא', 1.0), (27, 3, 'לא', 1.0),
                (27, 0, 'לא יודע', 1.0), (27, 1, 'לא יודע', 1.0), (27, 2, 'לא יודע', 1.0), (27, 3, 'לא יודע', 1.0),
                (27, 0, 'כנראה', 1.0), (27, 1, 'כנראה', 1.0), (27, 2, 'כנראה', 1.0), (27, 3, 'כנראה', 1.0),

                ## Question 28

                (28, 0, 'כן', 1.0), (28, 1, 'כן', 1.0), (28, 2, 'כן', 1.0), (28, 3, 'כן', 1.0),
                (28, 0, 'לא', 1.0), (28, 1, 'לא', 1.0), (28, 2, 'לא', 1.0), (28, 3, 'לא', 1.0),
                (28, 0, 'לא יודע', 1.0), (28, 1, 'לא יודע', 1.0), (28, 2, 'לא יודע', 1.0), (28, 3, 'לא יודע', 1.0),
                (28, 0, 'כנראה', 1.0), (28, 1, 'כנראה', 1.0), (28, 2, 'כנראה', 1.0), (28, 3, 'כנראה', 1.0)
            ]
            records = [
                {"question_id": qid, "triangle_id": tid, "answer_type": ans, "multiplier": mult}
                for qid, tid, ans, mult in InitialAnswerMultipliersData
            ]

            conn.execute(insert(InitialAnswerMultipliers), records)
            print("✅ הנתונים הוזנו לטבלת InitialAnswerMultipliers")
        else:
            print("⚠️ הנתונים כבר קיימים בטבלה")



# הכנסת פידבק משתמש
def insert_feedback():
    InputFB = metadata.tables["inputFB"]
    with engine.begin() as conn:
        existing_feedback = conn.execute(select(InputFB)).fetchall()
        if not existing_feedback:
            conn.execute(insert(InputFB), [
                {"fbID": 4, "fb": "לא הצלחתי הפעם"},
                {"fbID": 5, "fb": "הצלחתי תודה"},
                {"fbID": 6, "fb": "התקדמתי אבל אנסה תרגיל חדש"},
                {"fbID": 7, "fb": "חזרה לתרגיל"}
            ])
            print("✅ הנתונים לטבלת inputFB הוזנו בהצלחה!")

    ##מזין את הקדימויות בין השאלות - שאלות שלא יכולות להישאל לפני ששאלות אחרות נשאלו
def insert_question_prerequisites():
    QuestionPrerequisites = metadata.tables["QuestionPrerequisites"]
    Questions = metadata.tables["Questions"]

    prerequisite_pairs = [
        (1,15), (3, 14), (3, 15), (3, 16), (3, 17), (3, 18),(3,19),(3,20),(3,21),(3,22),
        (4, 23), (5, 23), (4, 24), (5, 24), (4, 25), (5, 25),
        (6, 19), (7, 19), (6, 20), (7, 20), (6, 21), (7, 21), (6, 22), (7, 22)
    ]

    with engine.begin() as conn:
        # שליפת מזהי שאלות קיימות
        existing_ids = set(row[0] for row in conn.execute(select(Questions.c.question_id)))

        # סינון רשומות לא חוקיות
        valid_pairs = [
            {"prerequisite_question_id": a, "dependent_question_id": b}
            for (a, b) in prerequisite_pairs
            if a in existing_ids and b in existing_ids
        ]

        existing = conn.execute(select(QuestionPrerequisites)).fetchall()
        if not existing and valid_pairs:
            conn.execute(insert(QuestionPrerequisites), valid_pairs)
            print("✅ הוזנו תנאי קדימות לשאלות לטבלה QuestionPrerequisites.")
        else:
            print("⚠️ תנאי הקדימות כבר קיימים או שאין רשומות חוקיות להזין.")


# פונקציה לשליפת כל הנתונים מכל הטבלאות והדפסתם


def print_all_tables():
    with engine.connect() as conn:
        print("\n📌 **תוכן כל הטבלאות במסד הנתונים:**\n")

        for table_name in metadata.tables:
            table = metadata.tables[table_name]
            result = conn.execute(select(table)).fetchall()

            print(f"📂 **{table_name}** ({len(result)} רשומות)")
            if result:
                for row in result:
                    print(row)
            else:
                print("⚠️ הטבלה ריקה!\n")

# **הרצת כל הפונקציות**
if __name__ == "__main__":
    check_tables()
    insert_triangles()
    insert_theorems()
    insert_questions()
    insert_theorem_question_matrix()
    insert_answers()
    insert_feedback()
    insert_initial_answer_multipliers()
    insert_theorem_triangle_matrix()
    insert_question_prerequisites()
    print_all_tables()



